/**
 * Copyright 2016 Amazon.com,
 * Inc. or its affiliates. All Rights Reserved.
 * 
 * Licensed under the Amazon Software License (the "License").
 * You may not use this file except in compliance with the
 * License. A copy of the License is located at
 * 
 *     http://aws.amazon.com/asl/
 * 
 * or in the "license" file accompanying this file. This file is
 * distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
 * CONDITIONS OF ANY KIND, express or implied. See the License
 * for the specific language governing permissions and
 * limitations under the License. 
 */


AWSCognito.CognitoIdentityServiceProvider.CognitoUser=function(){var a=function b(a){if(!(this instanceof b))throw new Error("CognitoUser constructor was not called with new.");if(null==a||null==a.Username||null==a.Pool)throw new Error("Username and pool information are required.");this.username=a.Username||"",this.pool=a.Pool,this.Session=null,this.client=new AWSCognito.CognitoIdentityServiceProvider({apiVersion:"2016-04-19"}),this.signInUserSession=null,this.authenticationFlowType="USER_SRP_AUTH"};return a.prototype.getSignInUserSession=function(){return this.signInUserSession},a.prototype.getUsername=function(){return this.username},a.prototype.getAuthenticationFlowType=function(){return this.authenticationFlowType},a.prototype.setAuthenticationFlowType=function(a){this.authenticationFlowType=a},a.prototype.authenticateUser=function(a,b){var c,d,e=new AWSCognito.CognitoIdentityServiceProvider.AuthenticationHelper(this.pool.getUserPoolId().split("_")[1],this.pool.getParanoia()),f=new AWSCognito.CognitoIdentityServiceProvider.DateHelper,g=this,h={};null!=this.deviceKey&&(h.DEVICE_KEY=this.deviceKey),h.USERNAME=this.username,h.SRP_A=e.getLargeAValue().toString(16),"CUSTOM_AUTH"===this.authenticationFlowType&&(h.CHALLENGE_NAME="SRP_A"),this.client.makeUnauthenticatedRequest("initiateAuth",{AuthFlow:this.authenticationFlowType,ClientId:this.pool.getClientId(),AuthParameters:h,ClientMetadata:a.getValidationData()},function(h,i){if(h)return b.onFailure(h);var j=i.ChallengeParameters;g.username=j.USER_ID_FOR_SRP,c=new BigInteger(j.SRP_B,16),d=new BigInteger(j.SALT,16),g.getCachedDeviceKeyAndPassword();var k=e.getPasswordAuthenticationKey(g.username,a.getPassword(),c,d),l=sjcl.codec.base64.toBits(j.SECRET_BLOCK),m=new sjcl.misc.hmac(k,sjcl.hash.sha256);m.update(sjcl.codec.utf8String.toBits(g.pool.getUserPoolId().split("_")[1])),m.update(sjcl.codec.utf8String.toBits(g.username)),m.update(l);var n=f.getNowString();m.update(sjcl.codec.utf8String.toBits(n));var o=m.digest(),p=sjcl.codec.base64.fromBits(o),q={};q.USERNAME=g.username,q.PASSWORD_CLAIM_SECRET_BLOCK=j.SECRET_BLOCK,q.TIMESTAMP=n,q.PASSWORD_CLAIM_SIGNATURE=p,null!=g.deviceKey&&(q.DEVICE_KEY=g.deviceKey),g.client.makeUnauthenticatedRequest("respondToAuthChallenge",{ChallengeName:"PASSWORD_VERIFIER",ClientId:g.pool.getClientId(),ChallengeResponses:q,Session:i.Session},function(a,c){if(a)return b.onFailure(a);var d=c.ChallengeName;if(null!=d&&"SMS_MFA"===d)return g.Session=c.Session,b.mfaRequired(d);if(null!=d&&"CUSTOM_CHALLENGE"===d)return g.Session=c.Session,b.customChallenge(c.ChallengeParameters);if(null!=d&&"DEVICE_SRP_AUTH"===d)g.getDeviceResponse(b);else{if(g.signInUserSession=g.getCognitoUserSession(c.AuthenticationResult),g.cacheTokens(),null==c.AuthenticationResult.NewDeviceMetadata)return b.onSuccess(g.signInUserSession);var f=(e.generateHashDevice(c.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,c.AuthenticationResult.NewDeviceMetadata.DeviceKey),{Salt:sjcl.codec.base64.fromBits(sjcl.codec.hex.toBits(e.getSaltDevices().toString(16))),PasswordVerifier:sjcl.codec.base64.fromBits(sjcl.codec.hex.toBits(e.getVerifierDevices().toString(16)))});g.verifierDevices=sjcl.codec.base64.fromBits(e.getVerifierDevices()),g.deviceGroupKey=c.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,g.randomPassword=e.getRandomPassword(),g.client.makeUnauthenticatedRequest("confirmDevice",{DeviceKey:c.AuthenticationResult.NewDeviceMetadata.DeviceKey,AccessToken:g.signInUserSession.getAccessToken().getJwtToken(),DeviceSecretVerifierConfig:f,DeviceName:navigator.userAgent},function(a,d){return a?b.onFailure(a):(g.deviceKey=c.AuthenticationResult.NewDeviceMetadata.DeviceKey,g.cacheDeviceKeyAndPassword(),d.UserConfirmationNecessary===!0?b.onSuccess(g.signInUserSession,d.UserConfirmationNecessary):b.onSuccess(g.signInUserSession))})}})})},a.prototype.getDeviceResponse=function(a){var b=new AWSCognito.CognitoIdentityServiceProvider.AuthenticationHelper(this.deviceGroupKey,this.pool.getParanoia()),c=new AWSCognito.CognitoIdentityServiceProvider.DateHelper,d=this,e={};e.USERNAME=this.username,e.DEVICE_KEY=this.deviceKey,e.SRP_A=b.getLargeAValue().toString(16),this.client.makeUnauthenticatedRequest("respondToAuthChallenge",{ChallengeName:"DEVICE_SRP_AUTH",ClientId:this.pool.getClientId(),ChallengeResponses:e},function(e,f){if(e)return a.onFailure(e);var g=f.ChallengeParameters,h=new BigInteger(g.SRP_B,16),i=new BigInteger(g.SALT,16),j=b.getPasswordAuthenticationKey(d.deviceKey,d.randomPassword,h,i),k=sjcl.codec.base64.toBits(g.SECRET_BLOCK),l=new sjcl.misc.hmac(j,sjcl.hash.sha256);l.update(sjcl.codec.utf8String.toBits(d.deviceGroupKey)),l.update(sjcl.codec.utf8String.toBits(d.deviceKey)),l.update(k);var m=c.getNowString();l.update(sjcl.codec.utf8String.toBits(m));var n=l.digest(),o=sjcl.codec.base64.fromBits(n),p={};p.USERNAME=d.username,p.PASSWORD_CLAIM_SECRET_BLOCK=g.SECRET_BLOCK,p.TIMESTAMP=m,p.PASSWORD_CLAIM_SIGNATURE=o,p.DEVICE_KEY=d.deviceKey,d.client.makeUnauthenticatedRequest("respondToAuthChallenge",{ChallengeName:"DEVICE_PASSWORD_VERIFIER",ClientId:d.pool.getClientId(),ChallengeResponses:p,Session:f.Session},function(b,c){return b?a.onFailure(b):(d.signInUserSession=d.getCognitoUserSession(c.AuthenticationResult),d.cacheTokens(),a.onSuccess(d.signInUserSession))})})},a.prototype.confirmRegistration=function(a,b,c){this.client.makeUnauthenticatedRequest("confirmSignUp",{ClientId:this.pool.getClientId(),ConfirmationCode:a,Username:this.username,ForceAliasCreation:b},function(a,b){return a?c(a,null):c(null,"SUCCESS")})},a.prototype.sendCustomChallengeAnswer=function(a,b){var c={};c.USERNAME=this.username,c.ANSWER=a;var d=this;this.client.makeUnauthenticatedRequest("respondToAuthChallenge",{ChallengeName:"CUSTOM_CHALLENGE",ChallengeResponses:c,ClientId:this.pool.getClientId(),Session:this.Session},function(a,c){if(a)return b.onFailure(a);var e=c.ChallengeName;return null!=e&&"CUSTOM_CHALLENGE"===e?(d.Session=c.Session,b.customChallenge(c.challengeParameters)):(d.signInUserSession=d.getCognitoUserSession(c.AuthenticationResult),d.cacheTokens(),b.onSuccess(d.signInUserSession))})},a.prototype.sendMFACode=function(a,b){var c={};c.USERNAME=this.username,c.SMS_MFA_CODE=a,null!=this.deviceKey&&(c.DEVICE_KEY=this.deviceKey);var d=this;this.client.makeUnauthenticatedRequest("respondToAuthChallenge",{ChallengeName:"SMS_MFA",ChallengeResponses:c,ClientId:this.pool.getClientId(),Session:d.Session},function(a,c){if(a)return b.onFailure(a);if(d.signInUserSession=d.getCognitoUserSession(c.AuthenticationResult),d.cacheTokens(),null==c.AuthenticationResult.NewDeviceMetadata)return b.onSuccess(d.signInUserSession);var e=new AWSCognito.CognitoIdentityServiceProvider.AuthenticationHelper(d.pool.getUserPoolId().split("_")[1],d.pool.getParanoia()),f=(e.generateHashDevice(c.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,c.AuthenticationResult.NewDeviceMetadata.DeviceKey),{Salt:sjcl.codec.base64.fromBits(sjcl.codec.hex.toBits(e.getSaltDevices().toString(16))),PasswordVerifier:sjcl.codec.base64.fromBits(sjcl.codec.hex.toBits(e.getVerifierDevices().toString(16)))});d.verifierDevices=sjcl.codec.base64.fromBits(e.getVerifierDevices()),d.deviceGroupKey=c.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,d.randomPassword=e.getRandomPassword(),d.client.makeUnauthenticatedRequest("confirmDevice",{DeviceKey:c.AuthenticationResult.NewDeviceMetadata.DeviceKey,AccessToken:d.signInUserSession.getAccessToken().getJwtToken(),DeviceSecretVerifierConfig:f,DeviceName:navigator.userAgent},function(a,e){return a?b.onFailure(a):(d.deviceKey=c.AuthenticationResult.NewDeviceMetadata.DeviceKey,d.cacheDeviceKeyAndPassword(),e.UserConfirmationNecessary===!0?b.onSuccess(d.signInUserSession,e.UserConfirmationNecessary):b.onSuccess(d.signInUserSession))})})},a.prototype.changePassword=function(a,b,c){return null!=this.signInUserSession&&this.signInUserSession.isValid()?void this.client.makeUnauthenticatedRequest("changePassword",{PreviousPassword:a,ProposedPassword:b,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(a,b){return a?c(a,null):c(null,"SUCCESS")}):c(new Error("User is not authenticated"),null)},a.prototype.enableMFA=function(a){if(null==this.signInUserSession||!this.signInUserSession.isValid())return a(new Error("User is not authenticated"),null);var b=[],c={DeliveryMedium:"SMS",AttributeName:"phone_number"};b.push(c),this.client.makeUnauthenticatedRequest("setUserSettings",{MFAOptions:b,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(b,c){return b?a(b,null):a(null,"SUCCESS")})},a.prototype.disableMFA=function(a){if(null==this.signInUserSession||!this.signInUserSession.isValid())return a(new Error("User is not authenticated"),null);var b=[];this.client.makeUnauthenticatedRequest("setUserSettings",{MFAOptions:b,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(b,c){return b?a(b,null):a(null,"SUCCESS")})},a.prototype.deleteUser=function(a){return null!=this.signInUserSession&&this.signInUserSession.isValid()?void this.client.makeUnauthenticatedRequest("deleteUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(b,c){return b?a(b,null):a(null,"SUCCESS")}):a(new Error("User is not authenticated"),null)},a.prototype.updateAttributes=function(a,b){return null!=this.signInUserSession&&this.signInUserSession.isValid()?void this.client.makeUnauthenticatedRequest("updateUserAttributes",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),UserAttributes:a},function(a,c){return a?b(a,null):b(null,"SUCCESS")}):b(new Error("User is not authenticated"),null)},a.prototype.getUserAttributes=function(a){return null!=this.signInUserSession&&this.signInUserSession.isValid()?void this.client.makeUnauthenticatedRequest("getUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(b,c){if(b)return a(b,null);for(var d=[],e=0;e<c.UserAttributes.length;e++){var f={Name:c.UserAttributes[e].Name,Value:c.UserAttributes[e].Value},g=new AWSCognito.CognitoIdentityServiceProvider.CognitoUserAttribute(f);d.push(g)}return a(null,d)}):a(new Error("User is not authenticated"),null)},a.prototype.deleteAttributes=function(a,b){return null!=this.signInUserSession&&this.signInUserSession.isValid()?void this.client.makeUnauthenticatedRequest("deleteUserAttributes",{UserAttributeNames:a,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(a,c){return a?b(a,null):b(null,"SUCCESS")}):b(new Error("User is not authenticated"),null)},a.prototype.resendConfirmationCode=function(a){this.client.makeUnauthenticatedRequest("resendConfirmationCode",{ClientId:this.pool.getClientId(),Username:this.username},function(b,c){return b?a(b,null):a(null,"SUCCESS")})},a.prototype.getSession=function(a){if(null==this.username)return a(new Error("Username is null. Cannot retrieve a new session"),null);if(null!=this.signInUserSession&&this.signInUserSession.isValid())return a(null,this.signInUserSession);var b="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".idToken",c="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".accessToken",d="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".refreshToken",e=window.localStorage;if(e.getItem(b)){var f=new AWSCognito.CognitoIdentityServiceProvider.CognitoIdToken({IdToken:e.getItem(b)}),g=new AWSCognito.CognitoIdentityServiceProvider.CognitoAccessToken({AccessToken:e.getItem(c)}),h=new AWSCognito.CognitoIdentityServiceProvider.CognitoRefreshToken({RefreshToken:e.getItem(d)}),i={IdToken:f,AccessToken:g,RefreshToken:h},j=new AWSCognito.CognitoIdentityServiceProvider.CognitoUserSession(i);if(j.isValid())return this.signInUserSession=j,a(null,this.signInUserSession);if(null==h.getToken())return a(new Error("Cannot retrieve a new session. Please authenticate."),null);this.refreshSession(h,a)}},a.prototype.refreshSession=function(a,b){var c={};c.REFRESH_TOKEN=a.getToken();var d="CognitoIdentityServiceProvider."+this.pool.getClientId()+".LastAuthUser",e=window.localStorage;if(e.getItem(d)){this.username=e.getItem(d);var f="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".deviceKey";this.deviceKey=e.getItem(f),c.DEVICE_KEY=this.deviceKey}var g=this;this.client.makeUnauthenticatedRequest("initiateAuth",{ClientId:this.pool.getClientId(),AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:c},function(a,c){return a?b(a,null):c?(g.signInUserSession=g.getCognitoUserSession(c.AuthenticationResult),g.cacheTokens(),b(null,g.signInUserSession)):void 0})},a.prototype.cacheTokens=function(){var a="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".idToken",b="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".accessToken",c="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".refreshToken",d="CognitoIdentityServiceProvider."+this.pool.getClientId()+".LastAuthUser",e=window.localStorage;e.setItem(a,this.signInUserSession.getIdToken().getJwtToken()),e.setItem(b,this.signInUserSession.getAccessToken().getJwtToken()),e.setItem(c,this.signInUserSession.getRefreshToken().getToken()),e.setItem(d,this.username)},a.prototype.cacheDeviceKeyAndPassword=function(){var a="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".deviceKey",b="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".randomPasswordKey",c="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".deviceGroupKey",d=window.localStorage;d.setItem(a,this.deviceKey),d.setItem(b,this.randomPassword),d.setItem(c,this.deviceGroupKey)},a.prototype.getCachedDeviceKeyAndPassword=function(){var a="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".deviceKey",b="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".randomPasswordKey",c="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".deviceGroupKey",d=window.localStorage;d.getItem(a)&&(this.deviceKey=d.getItem(a),this.randomPassword=d.getItem(b),this.deviceGroupKey=d.getItem(c))},a.prototype.clearCachedDeviceKeyAndPassword=function(){var a="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".deviceKey",b="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".randomPasswordKey",c="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".deviceGroupKey",d=window.localStorage;d.removeItem(a),d.removeItem(b),d.removeItem(c)},a.prototype.clearCachedTokens=function(){var a="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".idToken",b="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".accessToken",c="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username+".refreshToken",d="CognitoIdentityServiceProvider."+this.pool.getClientId()+".LastAuthUser",e=window.localStorage;e.removeItem(a),e.removeItem(b),e.removeItem(c),e.removeItem(d)},a.prototype.getCognitoUserSession=function(a){var b=new AWSCognito.CognitoIdentityServiceProvider.CognitoIdToken(a),c=new AWSCognito.CognitoIdentityServiceProvider.CognitoAccessToken(a),d=new AWSCognito.CognitoIdentityServiceProvider.CognitoRefreshToken(a),e={IdToken:b,AccessToken:c,RefreshToken:d};return new AWSCognito.CognitoIdentityServiceProvider.CognitoUserSession(e)},a.prototype.forgotPassword=function(a){this.client.makeUnauthenticatedRequest("forgotPassword",{ClientId:this.pool.getClientId(),Username:this.username},function(b,c){return b?a.onFailure(b):"function"==typeof a.inputVerificationCode?a.inputVerificationCode(c):a.onSuccess()})},a.prototype.confirmPassword=function(a,b,c){this.client.makeUnauthenticatedRequest("confirmForgotPassword",{ClientId:this.pool.getClientId(),Username:this.username,ConfirmationCode:a,Password:b},function(a,b){return a?c.onFailure(a):c.onSuccess()})},a.prototype.getAttributeVerificationCode=function(a,b){return null!=this.signInUserSession&&this.signInUserSession.isValid()?void this.client.makeUnauthenticatedRequest("getUserAttributeVerificationCode",{AttributeName:a,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(a,c){return a?b.onFailure(a):b.inputVerificationCode(c)}):b(new Error("User is not authenticated"),null)},a.prototype.verifyAttribute=function(a,b,c){return null!=this.signInUserSession&&this.signInUserSession.isValid()?void this.client.makeUnauthenticatedRequest("verifyUserAttribute",{AttributeName:a,Code:b,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(a,b){return a?c.onFailure(a):c.onSuccess("SUCCESS")}):c(new Error("User is not authenticated"),null)},a.prototype.getDevice=function(a){return null!=this.signInUserSession&&this.signInUserSession.isValid()?void this.client.makeUnauthenticatedRequest("getDevice",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey},function(b,c){return b?a.onFailure(b):a.onSuccess(c)}):a(new Error("User is not authenticated"),null)},a.prototype.forgetDevice=function(a){var b=this;return null!=this.signInUserSession&&this.signInUserSession.isValid()?void this.client.makeUnauthenticatedRequest("forgetDevice",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey},function(c,d){return c?a.onFailure(c):(b.deviceKey=null,b.deviceGroupkey=null,b.randomPassword=null,b.clearCachedDeviceKeyAndPassword(),a.onSuccess("SUCCESS"))}):a(new Error("User is not authenticated"),null)},a.prototype.setDeviceStatusRemembered=function(a){return null!=this.signInUserSession&&this.signInUserSession.isValid()?void this.client.makeUnauthenticatedRequest("updateDeviceStatus",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey,DeviceRememberedStatus:"remembered"},function(b,c){return b?a.onFailure(b):a.onSuccess("SUCCESS")}):a(new Error("User is not authenticated"),null)},a.prototype.setDeviceStatusNotRemembered=function(a){return null!=this.signInUserSession&&this.signInUserSession.isValid()?void this.client.makeUnauthenticatedRequest("updateDeviceStatus",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey,DeviceRememberedStatus:"not_remembered"},function(b,c){return b?a.onFailure(b):a.onSuccess("SUCCESS")}):a(new Error("User is not authenticated"),null)},a.prototype.listDevices=function(a,b,c){return null!=this.signInUserSession&&this.signInUserSession.isValid()?void this.client.makeUnauthenticatedRequest("listDevices",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),Limit:a,PaginationToken:b},function(a,b){return a?c.onFailure(a):c.onSuccess(b)}):c(new Error("User is not authenticated"),null)},a.prototype.globalSignOut=function(a){var b=this;return null!=this.signInUserSession&&this.signInUserSession.isValid()?void this.client.makeUnauthenticatedRequest("globalSignOut",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(c,d){return c?a.onFailure(c):(b.clearCachedTokens(),a.onSuccess("SUCCESS"))}):a(new Error("User is not authenticated"),null)},a.prototype.signOut=function(){this.signInUserSession=null,this.clearCachedTokens()},a}(),AWSCognito.CognitoIdentityServiceProvider.CognitoUserPool=function(){var a=function b(a){if(!(this instanceof b))throw new Error("CognitoUserPool constructor was not called with new.");if(null==a||null==a.UserPoolId||null==a.ClientId)throw new Error("Both user pool Id and client Id are required.");this.userPoolId=a.UserPoolId,this.clientId=a.ClientId,this.paranoia=a.Paranoia||0,this.client=new AWSCognito.CognitoIdentityServiceProvider({apiVersion:"2016-04-19"})};return a.prototype.getUserPoolId=function(){return this.userPoolId},a.prototype.getClientId=function(){return this.clientId},a.prototype.getParanoia=function(){return this.paranoia},a.prototype.setParanoia=function(a){this.paranoia=a},a.prototype.signUp=function(a,b,c,d,e){var f=this;this.client.makeUnauthenticatedRequest("signUp",{ClientId:f.clientId,Username:a,Password:b,UserAttributes:c,ValidationData:d},function(b,c){if(b)return e(b,null);var d={Username:a,Pool:f},g={user:new AWSCognito.CognitoIdentityServiceProvider.CognitoUser(d),userConfirmed:c.UserConfirmed};return e(null,g)})},a.prototype.getCurrentUser=function(){var a="CognitoIdentityServiceProvider."+this.clientId+".LastAuthUser",b=window.localStorage,c=b.getItem(a);if(c){var d={Username:c,Pool:this};return new AWSCognito.CognitoIdentityServiceProvider.CognitoUser(d)}return null},a}(),AWSCognito.CognitoIdentityServiceProvider.CognitoRefreshToken=function(){var a=function b(a){if(!(this instanceof b))throw new Error("CognitoRefreshToken constructor was not called with new.");a=a||{},this.token=a.RefreshToken||""};return a.prototype.getToken=function(){return this.token},a}(),AWSCognito.CognitoIdentityServiceProvider.CognitoIdToken=function(){var a=function b(a){if(!(this instanceof b))throw new Error("CognitoIdToken constructor was not called with new.");a=a||{},this.jwtToken=a.IdToken||""};return a.prototype.getJwtToken=function(){return this.jwtToken},a.prototype.getExpiration=function(){var a=this.jwtToken.split(".")[1],b=JSON.parse(sjcl.codec.utf8String.fromBits(sjcl.codec.base64.toBits(a)));return b.exp},a}(),AWSCognito.CognitoIdentityServiceProvider.CognitoAccessToken=function(){var a=function b(a){if(!(this instanceof b))throw new Error("CognitoAccessToken constructor was not called with new.");a=a||{},this.jwtToken=a.AccessToken||""};return a.prototype.getJwtToken=function(){return this.jwtToken},a.prototype.getExpiration=function(){var a=this.jwtToken.split(".")[1],b=JSON.parse(sjcl.codec.utf8String.fromBits(sjcl.codec.base64.toBits(a)));return b.exp},a}(),AWSCognito.CognitoIdentityServiceProvider.AuthenticationDetails=function(){var a=function b(a){if(!(this instanceof b))throw new Error("AuthenticationDetails constructor was not called with new.");a=a||{},this.validationData=a.ValidationData||[],this.username=a.Username,this.password=a.Password};return a.prototype.getUsername=function(){return this.username},a.prototype.getPassword=function(){return this.password},a.prototype.getValidationData=function(){return this.validationData},a}(),AWSCognito.CognitoIdentityServiceProvider.CognitoUserSession=function(){var a=function b(a){if(!(this instanceof b))throw new Error("CognitoUserSession constructor was not called with new.");if(a=a||{},null==a.AccessToken||null==a.IdToken)throw new Error("Id token and Access Token must be present.");this.idToken=a.IdToken,this.refreshToken=a.RefreshToken,this.accessToken=a.AccessToken};return a.prototype.getIdToken=function(){return this.idToken},a.prototype.getRefreshToken=function(){return this.refreshToken},a.prototype.getAccessToken=function(){return this.accessToken},a.prototype.isValid=function(){var a=Math.floor(new Date/1e3);return a<this.accessToken.getExpiration()&&a<this.idToken.getExpiration()},a}(),AWSCognito.CognitoIdentityServiceProvider.CognitoUserAttribute=function(){var a=function b(a){if(!(this instanceof b))throw new Error("CognitoUserAttribute constructor was not called with new.");a=a||{},this.Name=a.Name||"",this.Value=a.Value||""};return a.prototype.getValue=function(){return this.Value},a.prototype.setValue=function(a){return this.Value=a,this},a.prototype.getName=function(){return this.Name},a.prototype.setName=function(a){return this.Name=a,this},a.prototype.toString=function(){return JSON.stringify(this)},a.prototype.toJSON=function(){return{Name:this.Name,Value:this.Value}},a}(),AWSCognito.CognitoIdentityServiceProvider.AuthenticationHelper=function(){var a=function b(a,c){if(!(this instanceof b))throw new Error("AuthenticationHelper constructor was not called with new.");this.N=new BigInteger("FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",16),this.g=new BigInteger("2"),this.k=new BigInteger(this.hexHash("00"+this.N.toString(16)+"0"+this.g.toString(16)),16),this.paranoia=c,this.smallAValue=this.generateRandomSmallA(),this.largeAValue=this.calculateA(this.smallAValue),this.infoBits=sjcl.codec.utf8String.toBits("Caldera Derived Key"),this.poolName=a};return a.prototype.getSmallAValue=function(){return this.smallAValue},a.prototype.getLargeAValue=function(){return this.largeAValue},a.prototype.generateRandomSmallA=function(){var a=sjcl.random.randomWords(32,this.paranoia),b=sjcl.codec.hex.fromBits(a),c=new BigInteger(b,16),d=c.mod(this.N);return d},a.prototype.generateRandomString=function(){var a=sjcl.random.randomWords(10,this.paranoia),b=sjcl.codec.base64.fromBits(a);return b},a.prototype.getRandomPassword=function(){return this.randomPassword},a.prototype.getSaltDevices=function(){return this.SaltToHashDevices},a.prototype.getVerifierDevices=function(){return this.verifierDevices},a.prototype.generateHashDevice=function(a,b){this.randomPassword=this.generateRandomString();var c=a+b+":"+this.randomPassword,d=this.hash(c),e=sjcl.random.randomWords(4,this.paranoia),f=sjcl.codec.hex.fromBits(e),g=new BigInteger(f,16),h=g.toString(16)[0];this.SaltToHashDevices=g.toString(16),g.toString(16).length%2===1?this.SaltToHashDevices="0"+this.SaltToHashDevices:-1!=="89ABCDEFabcdef".indexOf(h)&&(this.SaltToHashDevices="00"+this.SaltToHashDevices);var i=this.g.modPow(new BigInteger(this.hexHash(this.SaltToHashDevices+d),16),this.N),j=i.toString(16)[0];this.verifierDevices=i.toString(16),i.toString(16).length%2===1?this.verifierDevices="0"+this.verifierDevices:-1!=="89ABCDEFabcdef".indexOf(j)&&(this.verifierDevices="00"+this.verifierDevices)},a.prototype.calculateA=function(a){var b=this.g.modPow(a,this.N);if("0"===b.mod(this.N).toString())throw new Error("Illegal paramater. A mod N cannot be 0.");return b},a.prototype.calculateU=function(a,b){var c=a.toString(16)[0],d=b.toString(16)[0],e=a.toString(16),f=b.toString(16);a.toString(16).length%2===1?e="0"+e:-1!=="89ABCDEFabcdef".indexOf(c)&&(e="00"+e),b.toString(16).length%2===1?f="0"+f:-1!=="89ABCDEFabcdef".indexOf(d)&&(f="00"+f),this.UHexHash=this.hexHash(e+f);var g=new BigInteger(this.UHexHash,16);return g},a.prototype.hash=function(a){var b=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(a));return new Array(64-b.length).join("0")+b},a.prototype.hexHash=function(a){var b=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(sjcl.codec.hex.toBits(a)));return new Array(64-b.length).join("0")+b},a.prototype.computehkdf=function(a,b){var c=new sjcl.misc.hmac(b,sjcl.hash.sha256);c.update(a);var d=c.digest(),e=new sjcl.misc.hmac(d,sjcl.hash.sha256),f=sjcl.bitArray.concat(this.infoBits,sjcl.codec.utf8String.toBits(String.fromCharCode(1)));return e.update(f),sjcl.bitArray.clamp(e.digest(),128)},a.prototype.getPasswordAuthenticationKey=function(a,b,c,d){if(c.mod(this.N).equals(new BigInteger("0",16)))throw new Error("B cannot be zero.");if(this.UValue=this.calculateU(this.largeAValue,c),this.UValue.equals(new BigInteger("0",16)))throw new Error("U cannot be zero.");var e=this.poolName+a+":"+b,f=this.hash(e),g=d.toString(16)[0],h=d.toString(16);d.toString(16).length%2===1?h="0"+h:-1!=="89ABCDEFabcdef".indexOf(g)&&(h="00"+h);var i=new BigInteger(this.hexHash(h+f),16),j=this.g.modPow(i,this.N),k=c.subtract(this.k.multiply(j)),l=k.modPow(this.smallAValue.add(this.UValue.multiply(i)),this.N).mod(this.N),m=l.toString(16),n=l.toString(16)[0];l.toString(16).length%2===1?m="0"+m:-1!=="89ABCDEFabcdef".indexOf(n)&&(m="00"+m);var o=this.UHexHash,p=this.UHexHash[0];this.UHexHash.length%2===1?o="0"+o:this.UHexHash.length%2===0&&-1!=="89ABCDEFabcdef".indexOf(p)&&(o="00"+o);var q=this.computehkdf(sjcl.codec.hex.toBits(m),sjcl.codec.hex.toBits(o));return q},a}(),AWSCognito.CognitoIdentityServiceProvider.DateHelper=function(){var a=function(){};return a.prototype.getNowString=function(){var a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],b=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],c=new Date,d=b[c.getUTCDay()],e=a[c.getUTCMonth()],f=c.getUTCDate(),g=c.getUTCHours();10>g&&(g="0"+g);var h=c.getUTCMinutes();10>h&&(h="0"+h);var i=c.getUTCSeconds();10>i&&(i="0"+i);var j=c.getUTCFullYear(),k=d+" "+e+" "+f+" "+g+":"+h+":"+i+" UTC "+j;return k},a}();
//# sourceMappingURL=amazon-cognito-identity.min.js.map